# ebi-metagenomics/datagrabber: Output

## Introduction

This document describes the output produced by the pipeline.

The directories listed below will be created in the results directory after the pipeline has finished. All paths are relative to the top-level results directory.

## Pipeline overview

The pipeline is built using [Nextflow](https://www.nextflow.io/) and processes data using the following steps:

- [ENA metadata](#ena-metadata) - Downloaded metadata for the study
- [Downloaded FASTQ files](#downloaded-fastq-files) - Raw sequencing data organized by sample
- [Samplesheet](#samplesheet) - Generated samplesheet for downstream analysis
- [Pipeline information](#pipeline-information) - Report metrics generated during the workflow execution

## ENA metadata

<details markdown="1">
<summary>Output files</summary>

- `<STUDY_ACCESSION>/`
  - `ena_metadata.tsv`: Complete metadata for all samples in the study downloaded from ENA

</details>

The ENA metadata file contains comprehensive information about all samples in the study, including:
- Run accessions
- Library information (strategy, source, layout)
- Platform information
- FASTQ file URLs
- Sample descriptions and attributes

## Downloaded FASTQ files

<details markdown="1">
<summary>Output files</summary>

- `<STUDY_ACCESSION>/`
  - `<RUN_ACCESSION>/`
    - `<RUN_ACCESSION>.fastq.gz`: Single-end FASTQ file or first read of paired-end
    - `<RUN_ACCESSION>_1.fastq.gz`: Second read of paired-end data (if applicable)
    - `download_log.txt`: Download log for this sample

</details>

Each sample's FASTQ files are organized in individual directories named by their ENA run accession. The pipeline automatically handles both single-end and paired-end data:

- **Single-end**: One FASTQ file named `<RUN_ACCESSION>.fastq.gz`
- **Paired-end**: Two FASTQ files named `<RUN_ACCESSION>.fastq.gz` and `<RUN_ACCESSION>_1.fastq.gz`

## Samplesheet

<details markdown="1">
<summary>Output files</summary>

- `<STUDY_ACCESSION>/`
  - `miassembler_samplesheet.csv`: Formatted samplesheet for the miassembler pipeline

</details>

The generated samplesheet contains the following columns:
- `study_accession`: ENA study accession
- `reads_accession`: ENA run accession
- `fastq_1`: Path to first FASTQ file
- `fastq_2`: Path to second FASTQ file (paired-end only)
- `library_layout`: single or paired
- `library_source`: Source of the library (e.g., metagenomic)
- `library_strategy`: Sequencing strategy (e.g., WGS, AMPLICON)
- `platform`: Sequencing platform (e.g., ILLUMINA, LS454)
- `assembler`: Selected assembler (from --assembler parameter)
- `assembly_memory`: Memory allocation for assembly (from --memory parameter)
- `assembler_config`: Additional assembler configuration (empty by default)
- `contaminant_reference`: Path to contaminant reference (from --contaminant_reference parameter)
- `human_reference`: Human reference path (empty by default)
- `phix_reference`: PhiX reference path (empty by default)

This samplesheet can be used directly with the miassembler pipeline for downstream assembly and analysis.

## Pipeline information

<details markdown="1">
<summary>Output files</summary>

- `pipeline_info/`
  - Reports generated by Nextflow: `execution_report.html`, `execution_timeline.html`, `execution_trace.txt` and `pipeline_dag.dot`/`pipeline_dag.svg`.
  - Reports generated by the pipeline: `datagrabber_software_versions.yml`.
  - Parameters used by the pipeline run: `params.json`.

</details>

[Nextflow](https://www.nextflow.io/docs/latest/tracing.html) provides excellent functionality for generating various reports relevant to the running and execution of the pipeline. This will allow you to troubleshoot errors with the running of the pipeline, and also provide you with other information such as launch commands, run times and resource usage.